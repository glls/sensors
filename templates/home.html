<!DOCTYPE html>
<html lang="en" x-data="sensorData()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body>

<div class="container mt-4">
    <h1 class="text-center">Welcome to the Sensors Project</h1>

    <div class="row">
        <!-- Card 1: Latest Outdoor Sensor Reading -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Latest Outdoor Sensor Reading</div>
                <div class="card-body">
                    <template x-if="outdoorSensor">
                        <div>
                            <p><strong>Sensor ID:</strong> <span x-text="outdoorSensor.sensor_id"></span></p>
                            <p><strong>PM10:</strong> <span x-text="outdoorSensor.pm10"></span> µg/m³</p>
                            <p><strong>PM2.5:</strong> <span x-text="outdoorSensor.pm25"></span> µg/m³</p>
                            <p><strong>Temperature:</strong> <span x-text="outdoorSensor.temperature"></span> °C</p>
                            <p><strong>Humidity:</strong> <span x-text="outdoorSensor.humidity"></span> %</p>
                            <p><strong>Pressure:</strong> <span x-text="outdoorSensor.pressure"></span> hPa</p>
                            <p><strong>Signal:</strong> <span x-text="outdoorSensor.signal"></span> dBm</p>
                            <p><strong>Time:</strong> <span x-text="outdoorSensor.time"></span></p>
                        </div>
                    </template>
                    <p x-show="!outdoorSensor">No outdoor data available.</p>
                </div>
            </div>
        </div>

        <!-- Card 2: Latest Indoor Sensor Reading -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Latest Indoor Sensor Reading (ens160)</div>
                <div class="card-body">
                    <template x-if="indoorSensor">
                        <div>
                            <p><strong>Sensor ID:</strong> <span x-text="indoorSensor.sensor_id"></span></p>
                            <p><strong>AQI:</strong> <span x-text="indoorSensor.aqi"></span></p>
                            <p><strong>TVOC:</strong> <span x-text="indoorSensor.tvoc"></span></p>
                            <p><strong>eCO2:</strong> <span x-text="indoorSensor.eco2"></span></p>
                            <p><strong>Time:</strong> <span x-text="indoorSensor.time"></span></p>
                        </div>
                    </template>
                    <p x-show="!indoorSensor">No indoor data available.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Card 3: Latest Temperature Data (Sensor 1) -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Latest Temperature Data (Sensor 1)</div>
                <div class="card-body">
                    <template x-if="tempSensor1">
                        <div>
                            <p><strong>Temperature:</strong> <span x-text="tempSensor1.temperature"></span> °C</p>
                            <p><strong>Humidity:</strong> <span x-text="tempSensor1.humidity"></span> %</p>
                            <p><strong>Pressure:</strong> <span x-text="tempSensor1.pressure"></span> hPa</p>
                            <p><strong>Time:</strong> <span x-text="tempSensor1.time"></span></p>
                        </div>
                    </template>
                    <p x-show="!tempSensor1">No temperature data available for Sensor 1.</p>
                </div>
            </div>
        </div>

        <!-- Card 4: Latest Temperature Data (Sensor 2) -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Latest Temperature Data (Sensor 2)</div>
                <div class="card-body">
                    <template x-if="tempSensor2">
                        <div>
                            <p><strong>Temperature:</strong> <span x-text="tempSensor2.temperature"></span> °C</p>
                            <p><strong>Humidity:</strong> <span x-text="tempSensor2.humidity"></span> %</p>
                            <p><strong>Time:</strong> <span x-text="tempSensor2.time"></span></p>
                        </div>
                    </template>
                    <p x-show="!tempSensor2">No temperature data available for Sensor 2.</p>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    function sensorData() {
        return {
            clientCount: 0,
            outdoorSensor: null,
            indoorSensor: null,
            tempSensor1: null,
            tempSensor2: null,
            init() {
                const socket = new WebSocket('ws://' + window.location.host + '/ws/sensor_data/');
                socket.onmessage = (event) => {
                    const data = JSON.parse(event.data);

                    if (data.type === 'air') {
                        this.outdoorSensor = this.formatSensorData(data);
                    } else if (data.type === 'indoor') {
                        this.indoorSensor = this.formatSensorData(data);
                    } else if (data.type === 'temperature' && data.sensor_id === 1) {
                        this.tempSensor1 = this.formatSensorData(data);
                    } else if (data.type === 'temperature' && data.sensor_id === 2) {
                        this.tempSensor2 = this.formatSensorData(data);
                    }
                };
            },
            formatSensorData(data) {
                data.time = this.formatTime(data.time);
                return data;
            },
            formatTime(time) {
                const sensorTime = new Date(time);
                return sensorTime.toLocaleDateString('en-GB', {
                    weekday: 'short',
                    day: '2-digit',
                    month: '2-digit',
                    year: '2-digit',
                }) + ' ' + sensorTime.toLocaleTimeString('en-GB', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false,
                });
            }
        };
    }
</script>

</body>
</html>