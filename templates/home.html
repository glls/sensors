<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
    <h1 class="text-center">Welcome to the Sensors Project</h1>
    <p class="text-center"><strong>Connected Clients:</strong> {{ client_count }}</p>

    <div class="row">
        <!-- Card 1: Latest Outdoor Sensor Reading -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Latest Outdoor Sensor Reading</div>
                <div class="card-body" id="outdoor-sensor">
                    <p>No outdoor data available.</p>
                </div>
            </div>
        </div>

        <!-- Card 2: Latest Indoor Sensor Reading -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Latest Indoor Sensor Reading (ens160)</div>
                <div class="card-body" id="indoor-sensor">
                    <p>No indoor data available.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Card 3: Latest Temperature Data (Sensor 1) -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Latest Temperature Data (Sensor 1)</div>
                <div class="card-body" id="temp-sensor-1">
                    <p>No temperature data available for Sensor 1.</p>
                </div>
            </div>
        </div>

        <!-- Card 4: Latest Temperature Data (Sensor 2) -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Latest Temperature Data (Sensor 2)</div>
                <div class="card-body" id="temp-sensor-2">
                    <p>No temperature data available for Sensor 2.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Establish a single WebSocket connection
    const socket = new WebSocket('ws://' + window.location.host + '/ws/sensor_data/');

    socket.onmessage = function (event) {
        const data = JSON.parse(event.data);

        // Update the DOM based on the sensor type and ID
        if (data.type === 'air') {
            document.getElementById('outdoor-sensor').innerHTML = `
                <p><strong>Sensor ID:</strong> ${data.sensor_id}</p>
                <p><strong>PM10:</strong> ${data.pm10} µg/m³</p>
                <p><strong>PM2.5:</strong> ${data.pm25} µg/m³</p>
                <p><strong>Temperature:</strong> ${data.temperature} °C</p>
                <p><strong>Humidity:</strong> ${data.humidity} %</p>
                <p><strong>Pressure:</strong> ${data.pressure} hPa</p>
                <p><strong>Signal:</strong> ${data.signal} dBm</p>
                <p><strong>Time:</strong> ${data.time}</p>
            `;
        } else if (data.type === 'indoor') {
            document.getElementById('indoor-sensor').innerHTML = `
                <p><strong>Sensor ID:</strong> ${data.sensor_id}</p>
                <p><strong>AQI:</strong> ${data.aqi}</p>
                <p><strong>TVOC:</strong> ${data.tvoc}</p>
                <p><strong>eCO2:</strong> ${data.eco2}</p>
                <p><strong>Time:</strong> ${data.time}</p>
            `;
        } else if (data.type === 'temperature' && data.sensor_id === 1) {
            document.getElementById('temp-sensor-1').innerHTML = `
                <p><strong>Temperature:</strong> ${data.temperature} °C</p>
                <p><strong>Humidity:</strong> ${data.humidity} %</p>
                <p><strong>Pressure:</strong> ${data.pressure} hPa</p>
                <p><strong>Time:</strong> ${data.time}</p>
            `;
        } else if (data.type === 'temperature' && data.sensor_id === 2) {
            document.getElementById('temp-sensor-2').innerHTML = `
                <p><strong>Temperature:</strong> ${data.temperature} °C</p>
                <p><strong>Humidity:</strong> ${data.humidity} %</p>
                <p><strong>Time:</strong> ${data.time}</p>
            `;
        }
    };
</script>

</body>
</html>